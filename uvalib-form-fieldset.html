<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../uvalib-theme/uvalib-theme.html">
<link rel="import" href="uvalib-field.html">
<link rel="import" href="uvalib-form.html">
<link rel="import" href="uvalib-form-style.html">
<link rel="import" href="uvalib-field-checkbox.html">
<link rel="import" href="uvalib-field-html-markup.html">
<link rel="import" href="uvalib-field-input.html">
<link rel="import" href="uvalib-field-select.html">
<link rel="import" href="uvalib-field-textarea.html">
<link rel="import" href="uvalib-field-radios.html">

<dom-module id="uvalib-form-fieldset">
    <template>
    <custom-style>
      <style include="uvalib-theme uvalib-form-style">
      </style>
    </custom-style>

    <div class="form-field-group">
      <fieldset>
        <legend>[[element.title]]</legend>
        <template is="dom-repeat" items="{{_getFieldSetElements(element)}}" as="elem">
          <template is="dom-if" if="[[_isMarkup(fs_elem)]]">
            <uvalib-field-html-markup id="[[fs_elem.webform_key]]" element="{{fs_elem}}" hidden$="{{!_showField(fs_elem,_refresh)}}"></uvalib-field-html-markup>
          </template>
          <template is="dom-if" if="[[_isField(fs_elem)]]">
            <template is="dom-if" if="[[_isCheckbox(fs_elem)]]">
              <uvalib-field-checkbox id="[[fs_elem.webform_key]]" element="{{fs_elem}}" value="{{fs_elem.value}}" hidden$="{{!_showField(fs_elem,_refresh)}}"></uvalib-field-checkbox>
            </template>
          </template>
        </template>
      </fieldset>
    </div>
    </template>

    <script>
        // @TODO Needs review before used to identify which input types we want to support in a fieldset since this can have negative impact on accessibility.
        /**
         * `uvalib-form-fieldset`
         * Component that generates a group of related input fields with an associated title/heading.
         *
         * @customElement
         * @polymer
         * @demo demo/uvalib-form-fieldset.html
         */
        class UvalibFormFieldset extends UvalibForm(UvalibField(Polymer.Element)) {
            static get is() {
                return 'uvalib-form-fieldset';
            }
            static get properties() {
                return Object.assign(super.properties, {});
            }

            // Loop through the fieldset object key values and just examine the ones with
            // fld, mkup, fldset, ???
            _getFieldSetElements(el) {
                let fields = Array();
                for (var key in el) {
                    if (key.match(/^fld\_|mkup\_|actions/)) {
                        fields.push(el[key]);
                        if (el[key].type && el[key].type == 'textfield') {
                            el[key].type = 'text';
                        }
                    }
                }
                //console.log(fields);
                return fields;
            }
        }

        window.customElements.define(UvalibFormFieldset.is, UvalibFormFieldset);
    </script>
</dom-module>
